## ESP32-DASHCAM

Dashcam with Wi-Fi streaming.
Based on `ESP32 CameraWebServer` example in Arduino.
Inspired by (some ideas or/and code taken from):
	[jameszah's ESP32-CAM-Video-Recorder-junior](https://github.com/jameszah/ESP32-CAM-Video-Recorder-junior),
	[s60sc's ESP32-CAM_MJPEG2SD](https://github.com/s60sc/ESP32-CAM_MJPEG2SD),
	[gemi254's ESP32-CAM_MJPEG2SD](https://github.com/gemi254/ESP32-CAM_MJPEG2SD).

## About

ESP32-DASHCAM is made for ESP32-CAM development board. Tested on cheapest Chinese clone of Ai Thinker board with installed "esp32 by Espressif Systems version 1.0.4" in Arduino.

**Features:**
- Cyclically records video with fix length `avi_length` to memory card (built-in slot);
- Autodeletion of oldest file in case of memory lack;
- Video streaming;
- Wi-Fi Manager:
- Customizable framesize and quality via web interface save in EEPROM;
- Support of usual tactile and touch buttons to start/stop rec;
- Autostart video rec after booting.

## Under the hood

**Files**
At booting, new folder for video files is created with name `folder_num` equal to the number of dashcam boot.
This number is stored in EEPROM and is updated every boot.
Video files name are generated by concatenating `devname`, `folder_num` and `file_num` made.


**Wi-Fi**
To use streaming feature you and dashcam should be in one network.
Dashcam can:
	1. connect to your Wi-Fi point: if credentials are not saved in memory or dashcam cannot connect to saved Wi-Fi point, it will creat access point with name "`ESP_SSID`_Manager" and password hardcoded in `ESP_SSID` and `ESP_PWD`, after connecting to which you can choose your network via captive portal *(the library [WiFiManager](https://github.com/tzapu/WiFiManager) by tzapu does all the work of Wi-Fi Manager)*;
	2. create Access Point: after Wi-Fi Manager timeout (`WIFIMGR_TIMEOUT`), ESP32-DASHCAM creates it's own network with access point "`ESP_SSID`_AP" and password `ESP_PWD`.

**Autodeletion**
When there is no free space for the first time after booting, ESP32-DASHCAM searches the oldest folder.
Then, every time the space should be freed, the oldest file is searched in this folder until it becomes empty.
All job is done assuming files have strict structure:
```text
/
├──folder_num1
│  ├──devname.folder_num1.file_num1
│  ├──devname.folder_num1.file_num2
│  │...
│
├──folder_num2
│  ├──devname.folder_num2.file_num1
│  ├──devname.folder_num2.file_num2
│  │...
...
```
So, the oldest folder is in root, with the least number as name.
The oldest file is in the oldest folder and has name with the least number.

**Button**
You can use usual tactile or touch button. Your choice should be set in `BTN_IS_TOUCH` definition.


## Problems
[ ] When you change `quality` or `framesize` via web interface, all changes are applied immediately to observe changes in steaming. But video file will contain frames with different characteristics.
Another way: apply changes right before new video file, so it will be impossible to see changes in streaming immediately.
Right way: stop video rec, start new file. Dashcam is supposed to be used as a dashcam on my motorcycle: every frame count! No time to stop/start video!)) To be honest, it just doesn't bother me: I'll set the dashcam once and will forget about it.
[ ] Rewrit delete_oldest for the case of `folder_number` overflow.